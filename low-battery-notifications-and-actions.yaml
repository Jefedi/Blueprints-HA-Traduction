blueprint:
  name: Notifications et Actions des Appareils
  description: >
    # üì≥ Notifications et Actions des Appareils

    **Version: 2.7**

    ü§î Que fait votre appareil ? Soyez toujours au courant du d√©but √† la fin !üõéÔ∏èüîåüí∏

    **Si vous aimez mes blueprints et souhaitez montrer votre soutien ou simplement dire merci ?** [Cliquez ici](https://www.paypal.com/donate/?hosted_button_id=WAZS3QSDTPGA8) üôÇ

    <details>
    <summary><b>Le Processus d'Automatisation:</b> üëà</summary>

      - **D√©clencheur de l'Appareil:**
          - Entrez l'entit√© du capteur de puissance qui mesure la consommation actuelle de l'appareil. Les dispositifs courants avec ces capteurs incluent les prises intelligentes, les compteurs d'√©nergie, etc.
          - L'automatisation est d√©clench√©e lorsque la consommation de l'appareil d√©passe une puissance d√©finie.
          - L'automatisation se termine lorsque la consommation de l'appareil passe en dessous d'une valeur d√©finie.

      - **Options de Notification:**
          - Envoyez des messages de notification √† un ou plusieurs appareils lorsque l'appareil d√©marre, termine ou que le chien de garde est d√©clench√©.
          - Votre message de fin peut √©galement inclure des estimations de la consommation totale d'√©nergie et du co√ªt.
          - Incluez le suivi de la dur√©e dans votre message de fin pour suivre le temps de fonctionnement de l'appareil pour la t√¢che ou le cycle.
          - Choisissez d'envoyer des notifications r√©p√©t√©es pour vous rappeler lorsque le cycle de l'appareil est termin√©.
          - Les notifications sont compatibles avec les appareils Apple iOS et Android, garantissant une accessibilit√© universelle.

      - **Suivi de la Puissance:**
          - Utilisez le suivi de la puissance pour estimer la consommation totale d'√©nergie et le co√ªt.

          ‚ö†Ô∏è **Avertissement** - Ces valeurs sont des estimations et doivent √™tre utilis√©es uniquement comme guide. Veuillez √©viter de vous fier uniquement √† ces estimations pour leur exactitude et les utiliser √† vos propres risques. Nous ne pouvons √™tre tenus responsables des inexactitudes ou des pertes, dommages, d√©sagr√©ments ou autres probl√®mes qui peuvent survenir.

      - **Suivi de la Dur√©e:**
          - Vous pouvez inclure le suivi de la dur√©e dans votre message de fin pour surveiller le temps de fonctionnement de l'appareil pour chaque t√¢che ou cycle.

      - **Chien de Garde:**
          - L'option de chien de garde surveille l'ach√®vement du cycle de l'appareil.
          - Il envoie une notification si l'ach√®vement du cycle √©choue dans le d√©lai sp√©cifi√©.

      - **Actions Personnalis√©es:**
          - Adaptez les actions personnalis√©es selon vos pr√©f√©rences et besoins, am√©liorant la fonctionnalit√© de l'automatisation.
          - Configurez des actions telles que le d√©clenchement d'annonces sur des plateformes comme The Voice (HA), Google, Alexa, etc., pour vous tenir inform√© des √©v√©nements de l'appareil.

      - **Automatisation Bas√©e sur le Temps:**
          - Sp√©cifiez des heures de d√©but et de fin pr√©cises ainsi que des s√©lections de jours de la semaine pour d√©finir quand l'automatisation peut s'ex√©cuter.

      - **Conditions Personnalis√©es:**
          - Entrez toutes les conditions personnalis√©es pour personnaliser davantage le processus d'automatisation.
    </details>

    Besoin d'aide ?

    - FAQ: [Cliquez ici](https://community.home-assistant.io/t/650166/2)

    - Support Communautaire Incluant les Mises √† Jour: [Cliquez ici](https://community.home-assistant.io/t/650166)

    Obligatoire = *
  domain: automation
  input:
    appliance_power_settings:
      name: "Param√®tres de Puissance *"
      icon: mdi:current-ac
      collapsed: true
      input:
        power_sensor:
          name: Capteur de Puissance *
          description: >
            Veuillez entrer l'entit√© du capteur de puissance qui mesure la consommation actuelle de l'appareil.
            Les dispositifs courants qui poss√®dent ces capteurs incluent les prises intelligentes.
            Ce capteur est essentiel pour d√©clencher l'automatisation lorsque l'appareil d√©marre et lorsqu'il termine.
          default: []
          selector:
            entity:
              filter:
                domain: sensor
        start_appliance_power:
          name: D√©marrage - Seuil de Puissance de l'Appareil
          description: >
            Sp√©cifiez le seuil que la puissance doit d√©passer pour indiquer que l'appareil a d√©marr√© son cycle.
            La puissance doit passer de moins √† plus de ce seuil.
          default: 10
          selector:
            number:
              min: 1
              max: 30
              step: 1
              unit_of_measurement: watts
        start_time_delay:
          name: D√©marrage - D√©lai de Temps de Puissance
          description: >
            Sp√©cifiez la dur√©e pendant laquelle la puissance doit rester au-dessus du seuil pour indiquer que l'appareil a d√©marr√© son cycle.
            La puissance doit rester au-dessus de son seuil pendant le d√©lai de temps sp√©cifi√©.
            Si la puissance retombe en dessous du seuil dans ce d√©lai, elle ne d√©clenchera pas.
            Cela aidera √† pr√©venir un faux d√©clenchement.
          default: 1
          selector:
            number:
              min: 0.25
              max: 5
              step: 0.25
              unit_of_measurement: minutes
        running_dead_zone:
          name: Fonctionnement - Zone Morte
          description: >
            Apr√®s le d√©marrage de l'appareil, l'impl√©mentation d'une zone morte peut pr√©venir les faux d√©clenchements de fin,
            surtout si la puissance tombe bri√®vement en dessous du seuil de fin de l'appareil pendant le cycle apr√®s le d√©marrage.
            Le r√©glage de la zone morte au-del√† de ce point assure une conclusion fiable en pr√©venant un d√©clenchement de fin pr√©matur√©.

            De plus, l'option d'utiliser le 'Compte de R√©p√©tition de Fin' offre une fonctionnalit√© similaire sans √™tre soumise √† un d√©lai de temps sp√©cifique.
            Vous pouvez choisir d'utiliser √† la fois la 'Zone Morte de Fonctionnement' et le 'Compte de R√©p√©tition de Fin', avec le 'Compte de R√©p√©tition de Fin' se produisant apr√®s la 'Zone Morte de Fonctionnement'.
          default: 0
          selector:
            number:
              min: 0
              max: 120
              step: 1
              unit_of_measurement: minutes
        end_appliance_power:
          name: Fin - Seuil de Puissance de l'Appareil
          description: >
            Sp√©cifiez le seuil que la puissance doit rester en dessous pour indiquer que l'appareil a termin√© son cycle.
            La puissance doit passer de plus √† moins de ce seuil.
          default: 5
          selector:
            number:
              min: 1
              max: 30
              step: 1
              unit_of_measurement: watts
        end_time_delay:
          name: Fin - D√©lai de Temps de Puissance
          description: >
            Sp√©cifiez la dur√©e pendant laquelle la puissance doit rester en dessous du seuil pour indiquer que l'appareil a termin√© son cycle.
            La puissance doit rester en dessous de son seuil pendant le d√©lai de temps sp√©cifi√©.
            Si la puissance d√©passe √† nouveau le seuil dans ce d√©lai, elle ne d√©clenchera pas.
          default: 1
          selector:
            number:
              min: 0.25
              max: 5
              step: 0.25
              unit_of_measurement: minutes
        end_repeat_count:
          name: Fin - Compte de R√©p√©tition
          description: >
            Le nombre de fois que la condition 'Fin - Seuil de Puissance de l'Appareil + D√©lai de Temps de Puissance de Fin' doit √™tre remplie avant de d√©clencher la fin du cycle.
          default: 1
          selector:
            number:
              min: 1
              max: 10
              mode: slider
    start_notify_settings:
      name: "Notification de D√©marrage"
      icon: mdi:bell-check-outline
      collapsed: true
      input:
        include_start_notify:
          name: Utiliser les Options de Notification de D√©marrage (Optionnel)
          description: >
            S√©lectionnez 'Activer les Options de Notification de D√©marrage' si vous souhaitez recevoir une notification lorsque l'appareil d√©marre.
          default: disable_start_notify_options
          selector:
            select:
              options:
                - label: Activer les Options de Notification de D√©marrage
                  value: "enable_start_notify_options"
                - label: D√©sactiver les Options de Notification de D√©marrage
                  value: "disable_start_notify_options"
        start_notify_device:
          name: Appareils Notifi√©s
          description: >
            S√©lectionnez les appareils √† notifier lorsque l'appareil d√©marre.
          default: []
          selector:
            device:
              filter:
                - integration: mobile_app
              multiple: true
        start_title:
          name: Titre
          description: >
            Entrez le titre de la notification que vous souhaitez recevoir lorsque l'appareil d√©marre.
          default: Machine √† Laver
          selector:
            text:
        start_message:
          name: Message
          description: >
            Entrez le message de notification que vous souhaitez recevoir lorsque l'appareil d√©marre.
          default: YES! Une autre charge est EN MARCHE :)
          selector:
            text:
        start_notify_interruption_level:
          name: Niveau d'Interruption - iOS Seulement
          description: >
            Sur les appareils fonctionnant sous iOS 15 et versions ult√©rieures, vous pouvez configurer le niveau d'interruption de vos notifications pour vous assurer qu'elles sont livr√©es selon vos pr√©f√©rences.
            Choisissez le niveau d'interruption souhait√© dans la liste d√©roulante.
            Les notifications critiques et sensibles au temps doivent √™tre activ√©es dans l'application Home Assistant, et les notifications sensibles au temps doivent √™tre autoris√©es dans vos param√®tres de Focus.

            Pour plus d'informations sur les niveaux d'interruption [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: active
          selector:
            select:
              mode: dropdown
              options:
                - label: Default
                  value: "active"
                - label: Notifications Critiques
                  value: "critical"
                - label: Notifications Sensibles au Temps
                  value: "time-sensitive"
                - label: Notifications Silencieuses Sans R√©veil de l'√âcran
                  value: "passive"
        start_notify_sound:
          name: Son de Notification - iOS Seulement
          description: >
            L'application Home Assistant pour iOS inclut des sons de notification int√©gr√©s, et vous pouvez importer des sons depuis votre appareil iOS dans l'application.
            Des sons personnalis√©s peuvent √©galement √™tre ajout√©s via iTunes ou depuis votre stockage cloud.
            Lorsque vous entrez un son, assurez-vous d'utiliser le nom de fichier complet, y compris l'extension.

            Pour plus d'informations sur l'utilisation des sons dans l'application Home Assistant, [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            text:
        start_notify_data:
          name: Options Android Seulement (Optionnel)
          description: >
            Les notifications de **haute priorit√©** garantissent que vous recevez des alertes importantes imm√©diatement.
            Ces notifications contournent les d√©lais de livraison normaux et sont livr√©es instantan√©ment √† votre appareil.

            Les notifications **collantes** garantissent que les alertes importantes ne sont pas rejet√©es lorsqu'elles sont s√©lectionn√©es. Elles restent sur votre √©cran de notification jusqu'√† ce que vous les effaciez activement ou les balayiez, garantissant que les informations critiques restent visibles jusqu'√† ce qu'elles soient trait√©es.

            Les **canaux de notification** vous permettent d'organiser facilement diff√©rents param√®tres de notification,
            y compris les sons de notification, les vibrations et d'autres fonctionnalit√©s sp√©cifiques √† l'appareil.
            Si vous choisissez cette option, veuillez entrer le nom de votre canal souhait√© ci-dessous.

            Pour plus d'informations sur les options de notification [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            select:
              multiple: true
              options:
                - label: Haute Priorit√©
                  value: "high_priority"
                - label: Notification Collante
                  value: "sticky"
                - label: Canal de Notification
                  value: "channel"
        start_notify_channel:
          name: Canal de Notification - Android Seulement
          description: >
            Si vous avez choisi d'utiliser un canal de notification, entrez simplement le nom d'un canal existant pour appliquer ses param√®tres pr√©configur√©s.
            Si vous n'avez pas encore de canal, vous pouvez en cr√©er un nouveau en entrant un nom ici.
            Lorsque votre automatisation envoie la premi√®re notification, elle cr√©era le canal sur votre appareil.
            Apr√®s la cr√©ation du canal, vous pouvez personnaliser ses param√®tres de notification directement sur votre appareil.
          default: []
          selector:
            text:
    end_notify_settings:
      name: "Notification de Fin"
      icon: mdi:bell-ring-outline
      collapsed: true
      input:
        include_end_notify:
          name: Utiliser les Options de Notification de Fin (Optionnel)
          description: >
            S√©lectionnez 'Activer les Options de Notification de Fin' si vous souhaitez recevoir une notification lorsque l'appareil termine.
          default: disable_end_notify_options
          selector:
            select:
              options:
                - label: Activer les Options de Notification de Fin
                  value: "enable_end_notify_options"
                - label: D√©sactiver les Options de Notification de Fin
                  value: "disable_end_notify_options"
        end_notify_device:
          name: Appareils Notifi√©s
          description: >
            S√©lectionnez les appareils √† notifier lorsque l'appareil a termin√©.
          default: []
          selector:
            device:
              filter:
                - integration: mobile_app
              multiple: true
        end_message_title:
          name: Titre
          description: >
            Entrez le titre de la notification que vous souhaitez recevoir lorsque l'appareil a termin√©.
          default: Machine √† Laver
          selector:
            text:
        end_message:
          name: Message
          description: >
            Entrez le message de notification que vous souhaitez recevoir lorsque l'appareil a termin√©.
          default: Yippee la machine √† laver a termin√© !
          selector:
            text:
        end_notify_interruption_level:
          name: Niveau d'Interruption - iOS Seulement
          description: >
            Sur les appareils fonctionnant sous iOS 15 et versions ult√©rieures, vous pouvez configurer le niveau d'interruption de vos notifications pour vous assurer qu'elles sont livr√©es selon vos pr√©f√©rences.
            Choisissez le niveau d'interruption souhait√© dans la liste d√©roulante.
            Les notifications critiques et sensibles au temps doivent √™tre activ√©es dans l'application Home Assistant, et les notifications sensibles au temps doivent √™tre autoris√©es dans vos param√®tres de Focus.

            Pour plus d'informations sur les niveaux d'interruption [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: active
          selector:
            select:
              mode: dropdown
              options:
                - label: Default
                  value: "active"
                - label: Notifications Critiques
                  value: "critical"
                - label: Notifications Sensibles au Temps
                  value: "time-sensitive"
                - label: Notifications Silencieuses Sans R√©veil de l'√âcran
                  value: "passive"
        end_notify_sound:
          name: Son de Notification - iOS Seulement
          description: >
            L'application Home Assistant pour iOS inclut des sons de notification int√©gr√©s, et vous pouvez importer des sons depuis votre appareil iOS dans l'application.
            Des sons personnalis√©s peuvent √©galement √™tre ajout√©s via iTunes ou depuis votre stockage cloud.
            Lorsque vous entrez un son, assurez-vous d'utiliser le nom de fichier complet, y compris l'extension.

            Pour plus d'informations sur l'utilisation des sons dans l'application Home Assistant, [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            text:
        end_notify_data:
          name: Options Android Seulement (Optionnel)
          description: >
            Les notifications de **haute priorit√©** garantissent que vous recevez des alertes importantes imm√©diatement.
            Ces notifications contournent les d√©lais de livraison normaux et sont livr√©es instantan√©ment √† votre appareil.

            Les notifications **collantes** garantissent que les alertes importantes ne sont pas rejet√©es lorsqu'elles sont s√©lectionn√©es. Elles restent sur votre √©cran de notification jusqu'√† ce que vous les effaciez activement ou les balayiez, garantissant que les informations critiques restent visibles jusqu'√† ce qu'elles soient trait√©es.

            Les **canaux de notification** vous permettent d'organiser facilement diff√©rents param√®tres de notification,
            y compris les sons de notification, les vibrations et d'autres fonctionnalit√©s sp√©cifiques √† l'appareil.
            Si vous choisissez cette option, veuillez entrer le nom de votre canal souhait√© ci-dessous.

            Pour plus d'informations sur les options de notification [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            select:
              multiple: true
              options:
                - label: Haute Priorit√©
                  value: "high_priority"
                - label: Notification Collante
                  value: "sticky"
                - label: Canal de Notification
                  value: "channel"
        end_notify_channel:
          name: Canal de Notification - Android Seulement
          description: >
            Si vous avez choisi d'utiliser un canal de notification, entrez simplement le nom d'un canal existant pour appliquer ses param√®tres pr√©configur√©s.
            Si vous n'avez pas encore de canal, vous pouvez en cr√©er un nouveau en entrant un nom ici.
            Lorsque votre automatisation envoie la premi√®re notification, elle cr√©era le canal sur votre appareil.
            Apr√®s la cr√©ation du canal, vous pouvez personnaliser ses param√®tres de notification directement sur votre appareil.
          default: []
          selector:
            text:
        end_reminder_notification:
          name: Notification de Rappel (Optionnel)
          description: >
            R√©glez cette option pour recevoir des notifications r√©p√©t√©es vous rappelant que le cycle de l'appareil est termin√©.
            Les notifications continueront jusqu'√† ce que l'entit√© de notification de rappel soit activ√©e ou que le nombre maximum de notifications soit atteint, garantissant que vous ne manquez pas la fin du cycle tout en √©vitant les rappels excessifs.
          default: disable_reminder_notification
          selector:
            select:
              options:
                - label: Activer la Notification de Rappel
                  value: "enable_reminder_notification"
                - label: D√©sactiver la Notification de Rappel
                  value: "disable_reminder_notification"
        end_reminder_notification_entity:
          name: Entit√© de Notification de Rappel
          description: >
            S√©lectionnez l'entit√© qui arr√™tera la notification de rappel.
            Il s'agit g√©n√©ralement d'un capteur de contact plac√© sur la porte de votre appareil (par exemple, un capteur de porte de machine √† laver) qui, lorsqu'il est ouvert, arr√™tera les notifications de rappel.
          default: []
          selector:
            entity:
              filter:
                domain: binary_sensor
        end_reminder_notification_message:
          name: Message de Notification de Rappel
          description: >
            Entrez le message que vous souhaitez recevoir comme rappel que l'appareil a termin√© son cycle.
            Ce message sera envoy√© de mani√®re r√©p√©t√©e jusqu'√† ce que l'entit√© de notification de rappel soit activ√©e ou que le nombre maximum de notifications soit atteint.
          default: Hey! Votre linge propre est pr√™t, ne le laissez pas pendre !
          selector:
            text:
        end_reminder_notification_time_delay:
          name: D√©lai de Temps de Notification de Rappel
          description: >
            Sp√©cifiez la dur√©e d'attente entre les messages de rappel.
            Cela d√©finit l'intervalle de temps auquel le rappel sera envoy√© de mani√®re r√©p√©t√©e jusqu'√† ce que l'entit√© de notification de rappel soit activ√©e ou que le nombre maximum de notifications soit atteint.
          default: 10
          selector:
            number:
              min: 1
              max: 60
              step: 1
              unit_of_measurement: minutes
        end_reminder_notification_max_count:
          name: Nombre Maximum de Notifications de Rappel
          description: >
            Sp√©cifiez le nombre maximum de fois que la notification de rappel sera envoy√©e avant de s'arr√™ter.
            Cela garantit que vous ne recevrez pas de notifications excessives.
          default: 2
          selector:
            number:
              min: 1
              max: 10
              step: 1
    power_tracking_settings:
      name: "Suivi de la Puissance"
      icon: mdi:meter-electric-outline
      collapsed: true
      input:
        include_power_tracking:
          name: Utiliser l'Option de Suivi de la Puissance (Optionnel)
          description: >
            Vous avez la possibilit√© d'activer ou de d√©sactiver le suivi de la consommation d'√©nergie.
            Cette fonctionnalit√© vous permet d'inclure des informations sur la puissance dans votre message de notification de fin.
            Alternativement, vous pouvez choisir de mettre √† jour uniquement les assistants de d√©but et de fin pour une utilisation dans votre action personnalis√©e de fin.
            Vous avez √©galement le choix de recevoir soit le total de kWh utilis√© dans le cycle, soit le total de kWh utilis√©, accompagn√© d'une estimation du co√ªt pour le cycle.

            ‚ö†Ô∏è **Avertissement** - Ces valeurs sont des estimations et doivent √™tre utilis√©es uniquement comme guide.
            Veuillez √©viter de vous fier uniquement √† ces estimations pour leur exactitude et les utiliser √† vos propres risques.
            Nous ne pouvons √™tre tenus responsables des inexactitudes ou des pertes, dommages, d√©sagr√©ments ou autres probl√®mes qui peuvent survenir.
          default: disable_power_tracking
          selector:
            select:
              options:
                - label: Activer - Suivi de la Consommation d'√ânergie de Notification de Fin
                  value: enable_power_tracking
                - label: Activer - Suivi de la Consommation d'√ânergie de Notification de Fin + Co√ªt Total
                  value: enable_power_tracking_and_cost
                - label: Activer - Mise √† Jour des Assistants de D√©but et de Fin Seulement
                  value: enable_start_end_helpers
                - label: D√©sactiver - Suivi de la Consommation d'√ânergie
                  value: disable_power_tracking
        power_consumption_sensor:
          name: Suivi de la Puissance - Capteur de Puissance
          description: >
            S√©lectionnez le capteur qui fournit une mesure totale de la consommation d'√©nergie en kWh.
            Cela peut √™tre un total cumulatif ou un total quotidien.

            **Note** Si vous choisissez un capteur de total quotidien qui s'√©tend sur deux jours, les informations peuvent ne pas √™tre exactes.
            Cela est d√ª au fait que les valeurs doivent augmenter continuellement du d√©but √† la fin du cycle, sans √™tre r√©initialis√©es √† 0,0 kWh le jour suivant.
          default: []
          selector:
            entity:
              filter:
                domain: sensor
        end_message_kwh:
          name: Suivi de la Puissance - Message de Fin - Consommation d'√ânergie
          description: >
            Entrez le titre du message de notification pour la consommation d'√©nergie.
            Il s'agit de la description utilis√©e dans le message de notification de fin, juste avant la lecture en kWh.
          default: Consommation
          selector:
            text:
        end_message_cost:
          name: Suivi de la Puissance - Message de Fin - Co√ªt
          description: >
            Entrez le titre du message de notification pour l'estimation du co√ªt.
            Il s'agit de la description utilis√©e dans le message de notification de fin, juste avant la lecture du co√ªt.
          default: Co√ªt Approximatif $
          selector:
            text:
        cost_per_kwh:
          name: Suivi de la Puissance - Co√ªt par kWh
          description: >
            Veuillez entrer votre assistant de nombre ou un capteur d'√©nergie pour sp√©cifier le tarif de l'√©lectricit√© par kWh.
            Gardez √† l'esprit que le tarif utilis√© est d√©termin√© lorsque l'appareil termine et reste constant tout au long du cycle, m√™me s'il varie en fonction de l'heure de la journ√©e.
          default: []
          selector:
            entity:
              filter:
                domain:
                  - input_number
                  - sensor
        start_power_consumption:
          name: Suivi de la Puissance - Assistant de Nombre de D√©but
          description: >
            Entrez un assistant de nombre qui collectera la lecture en kWh au d√©but du cycle.
            Cela doit √™tre un assistant de nombre compl√®tement ind√©pendant et ne peut pas √™tre le m√™me que celui utilis√© dans l'entr√©e 'Suivi de la Puissance - Assistant de Nombre de Fin' ci-dessous.
          default: []
          selector:
            entity:
              filter:
                domain: input_number
        end_power_consumption:
          name: Suivi de la Puissance - Assistant de Nombre de Fin
          description: >
            Entrez un assistant de nombre qui collectera la lecture en kWh √† la fin du cycle.
            Cela doit √™tre un assistant de nombre compl√®tement ind√©pendant et ne peut pas √™tre le m√™me que celui utilis√© dans l'entr√©e 'Suivi de la Puissance - Assistant de Nombre de D√©but' ci-dessus.
          default: []
          selector:
            entity:
              filter:
                domain: input_number
    duration_tracking_settings:
      name: "Suivi de la Dur√©e"
      icon: mdi:timer-sand-complete
      collapsed: true
      input:
        include_duration_tracking:
          name: Utiliser l'Option de Suivi de la Dur√©e (Optionnel)
          description: >
            Vous pouvez inclure le suivi de la dur√©e dans votre message de notification de fin pour surveiller le temps de fonctionnement de l'appareil pour chaque t√¢che ou cycle.
          default: disable_duration_tracking
          selector:
            select:
              options:
                - label: Activer - Suivi de la Dur√©e de Notification de Fin
                  value: "enable_duration_tracking"
                - label: D√©sactiver le Suivi de la Dur√©e
                  value: "disable_duration_tracking"
        end_message_duration_tracking:
          name: Suivi de la Dur√©e - Message de Fin - Dur√©e
          description: >
            Entrez le titre du message de notification pour le suivi de la dur√©e.
            Il s'agit de la description utilis√©e dans le message de notification de fin, juste avant le temps de dur√©e.
          default: Dur√©e
          selector:
            text:
    watchdog_settings:
      name: "Chien de Garde"
      icon: mdi:dog-side
      collapsed: true
      input:
        include_watchdog:
          name: Utiliser l'Option de Chien de Garde (Optionnel)
          description: >
            Cette fonctionnalit√© surveille votre appareil pour s'assurer qu'il termine sa t√¢che dans le d√©lai imparti.
            Lorsqu'il est activ√©, si l'appareil ne parvient pas √† terminer sa t√¢che, l'automatisation expirera et enverra une notification pour vous alerter d'un probl√®me potentiel.
            Cela aide √† traiter rapidement tout probl√®me potentiel avec l'appareil.

            **NOTE** - Si le chien de garde est d√©clench√©, l'automatisation sera annul√©e.
          default: disable_watchdog
          selector:
            select:
              options:
                - label: Activer le Chien de Garde
                  value: "enable_watchdog"
                - label: D√©sactiver le Chien de Garde
                  value: "disable_watchdog"
        watchdog_timeframe:
          name: D√©lai
          description: >
            Sp√©cifiez la dur√©e maximale pendant laquelle le 'Chien de Garde' attendra que l'appareil termine sa t√¢che.
            Si l'appareil d√©passe ce d√©lai, le 'Chien de Garde' se d√©clenchera et vous en informera, indiquant un probl√®me potentiel.
          default: 00:00:00
          selector:
            duration:
        watchdog_title:
          name: Titre
          description: >
            Entrez le titre de la notification pour le d√©lai d'attente du chien de garde.
          default: ‚ö†Ô∏è Chien de Garde de l'Appareil
          selector:
            text:
        watchdog_message:
          name: Message
          description: >
            Entrez le message de notification pour le d√©lai d'attente du chien de garde.
          default: Oups! Il est temps de v√©rifier la machine √† laver.
          selector:
            text:
        watchdog_notify_interruption_level:
          name: Niveau d'Interruption - iOS Seulement
          description: >
            Sur les appareils fonctionnant sous iOS 15 et versions ult√©rieures, vous pouvez configurer le niveau d'interruption de vos notifications pour vous assurer qu'elles sont livr√©es selon vos pr√©f√©rences.
            Choisissez le niveau d'interruption souhait√© dans la liste d√©roulante.
            Les notifications critiques et sensibles au temps doivent √™tre activ√©es dans l'application Home Assistant, et les notifications sensibles au temps doivent √™tre autoris√©es dans vos param√®tres de Focus.

            Pour plus d'informations sur les niveaux d'interruption [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: active
          selector:
            select:
              mode: dropdown
              options:
                - label: Default
                  value: "active"
                - label: Notifications Critiques
                  value: "critical"
                - label: Notifications Sensibles au Temps
                  value: "time-sensitive"
                - label: Notifications Silencieuses Sans R√©veil de l'√âcran
                  value: "passive"
        watchdog_notify_sound:
          name: Son de Notification - iOS Seulement
          description: >
            L'application Home Assistant pour iOS inclut des sons de notification int√©gr√©s, et vous pouvez importer des sons depuis votre appareil iOS dans l'application.
            Des sons personnalis√©s peuvent √©galement √™tre ajout√©s via iTunes ou depuis votre stockage cloud.
            Lorsque vous entrez un son, assurez-vous d'utiliser le nom de fichier complet, y compris l'extension.

            Pour plus d'informations sur l'utilisation des sons dans l'application Home Assistant, [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            text:
        watchdog_notify_data:
          name: Options Android Seulement (Optionnel)
          description: >
            Les notifications de **haute priorit√©** garantissent que vous recevez des alertes importantes imm√©diatement.
            Ces notifications contournent les d√©lais de livraison normaux et sont livr√©es instantan√©ment √† votre appareil.

            Les notifications **collantes** garantissent que les alertes importantes ne sont pas rejet√©es lorsqu'elles sont s√©lectionn√©es. Elles restent sur votre √©cran de notification jusqu'√† ce que vous les effaciez activement ou les balayiez, garantissant que les informations critiques restent visibles jusqu'√† ce qu'elles soient trait√©es.

            Les **canaux de notification** vous permettent d'organiser facilement diff√©rents param√®tres de notification,
            y compris les sons de notification, les vibrations et d'autres fonctionnalit√©s sp√©cifiques √† l'appareil.
            Si vous choisissez cette option, veuillez entrer le nom de votre canal souhait√© ci-dessous.

            Pour plus d'informations sur les options de notification [Cliquez ici](https://community.home-assistant.io/t/650166/278)
          default: []
          selector:
            select:
              multiple: true
              options:
                - label: Haute Priorit√©
                  value: "high_priority"
                - label: Notification Collante
                  value: "sticky"
                - label: Canal de Notification
                  value: "channel"
        watchdog_notify_channel:
          name: Canal de Notification - Android Seulement
          description: >
            Si vous avez choisi d'utiliser un canal de notification, entrez simplement le nom d'un canal existant pour appliquer ses param√®tres pr√©configur√©s.
            Si vous n'avez pas encore de canal, vous pouvez en cr√©er un nouveau en entrant un nom ici.
            Lorsque votre automatisation envoie la premi√®re notification, elle cr√©era le canal sur votre appareil.
            Apr√®s la cr√©ation du canal, vous pouvez personnaliser ses param√®tres de notification directement sur votre appareil.
          default: []
          selector:
            text:
    custom_actions_settings:
      name: "Actions Personnalis√©es"
      icon: mdi:code-tags
      collapsed: true
      input:
        include_custom_actions:
          name: Utiliser les Options d'Action Personnalis√©e (Optionnel)
          description: >
            Personnalisez votre automatisation avec n'importe quelle action que vous souhaitez, qu'il s'agisse du d√©but, du chien de garde ou de la fin d'un cycle.
            Il est couramment utilis√© pour jouer des annonces sur The Voice (HA), Google, Alexa, etc.
            Il peut √©galement √™tre utilis√© pour d'autres services de notification ou toute autre action que vous souhaitez effectuer.
          default: []
          selector:
            select:
              options:
                - label: Activer les Actions Personnalis√©es - D√©but
                  value: "enable_start_custom_actions"
                - label: Activer les Actions Personnalis√©es - Chien de Garde
                  value: "enable_watchdog_custom_actions"
                - label: Activer les Actions Personnalis√©es - Fin
                  value: "enable_end_custom_actions"
              multiple: true
        start_custom_actions:
          name: Actions Personnalis√©es - D√©but
          description: >
            Entrez les actions que vous souhaitez ex√©cuter au d√©but.
          default: []
          selector:
            action:
        watchdog_custom_actions:
          name: Actions Personnalis√©es - Chien de Garde
          description: >
            Entrez les actions que vous souhaitez ex√©cuter lorsque le chien de garde est d√©clench√©.
          default: []
          selector:
            action:
        end_custom_actions:
          name: Actions Personnalis√©es - Fin
          description: >
            Entrez les actions que vous souhaitez ex√©cuter √† la fin.
          default: []
          selector:
            action:
    time_settings:
      name: "Temps"
      icon: mdi:clock-outline
      collapsed: true
      input:
        include_time:
          name: Utiliser les Options de Temps (Optionnel)
          description: >
            Cette option restreint l'automatisation √† s'ex√©cuter uniquement entre les heures de d√©but et de fin sp√©cifi√©es les jours de la semaine s√©lectionn√©s.
            Cela peut √™tre utile si vous faites fonctionner un appareil la nuit pendant que vous dormez et que vous ne souhaitez pas √™tre notifi√©.
          default: time_disabled
          selector:
            select:
              options:
                - label: Activer les options de temps
                  value: "time_enabled"
                - label: D√©sactiver les options de temps
                  value: "time_disabled"
        after_time:
          name: Heure de D√©but
          description: >
            D√©finissez l'heure de d√©but.
          default: 00:00:00
          selector:
            time:
        before_time:
          name: Heure de Fin
          description: >
            D√©finissez l'heure de fin.
          default: 00:00:00
          selector:
            time:
        weekday_options:
          name: Jours de la Semaine
          description: >
            S√©lectionnez les jours de la semaine o√π vous souhaitez que l'automatisation s'ex√©cute. Vous devez s√©lectionner "Activer les options de temps" ci-dessus pour que les s√©lections de jours de la semaine fonctionnent.
          default:
            - mon
            - tue
            - wed
            - thu
            - fri
            - sat
            - sun
          selector:
            select:
              multiple: true
              mode: list
              options:
                - label: Lundi
                  value: "mon"
                - label: Mardi
                  value: "tue"
                - label: Mercredi
                  value: "wed"
                - label: Jeudi
                  value: "thu"
                - label: Vendredi
                  value: "fri"
                - label: Samedi
                  value: "sat"
                - label: Dimanche
                  value: "sun"
    global_conditions_settings:
      name: "Conditions Globales"
      icon: mdi:earth
      collapsed: true
      input:
        global_conditions:
          name: Conditions Globales
          description: >
            Entrez toutes les conditions globales que vous souhaitez appliquer √† l'automatisation.
          default: []
          selector:
            condition:

mode: single
max_exceeded: silent

variables:
  power_sensor: !input power_sensor
  start_appliance_power: !input start_appliance_power
  start_time_delay: !input start_time_delay
  end_appliance_power: !input end_appliance_power
  end_time_delay: !input end_time_delay
  end_repeat_count: !input end_repeat_count
  include_start_notify: !input include_start_notify
  start_notify_device: !input start_notify_device
  start_title: !input start_title
  start_message: !input start_message
  start_notify_interruption_level: !input start_notify_interruption_level
  start_notify_sound: !input start_notify_sound
  start_notify_data: !input start_notify_data
  start_notify_channel: !input start_notify_channel
  running_dead_zone: !input running_dead_zone
  include_end_notify: !input include_end_notify
  end_notify_device: !input end_notify_device
  end_message_title: !input end_message_title
  end_message: !input end_message
  end_notify_interruption_level: !input end_notify_interruption_level
  end_notify_sound: !input end_notify_sound
  end_notify_data: !input end_notify_data
  end_notify_channel: !input end_notify_channel
  end_reminder_notification: !input end_reminder_notification
  end_reminder_notification_entity: !input end_reminder_notification_entity
  end_reminder_notification_message: !input end_reminder_notification_message
  end_reminder_notification_time_delay: !input end_reminder_notification_time_delay
  end_reminder_notification_max_count: !input end_reminder_notification_max_count
  include_power_tracking: !input include_power_tracking
  power_consumption_sensor: !input power_consumption_sensor
  end_message_kwh: !input end_message_kwh
  end_message_cost: !input end_message_cost
  cost_per_kwh: !input cost_per_kwh
  start_power_consumption: !input start_power_consumption
  end_power_consumption: !input end_power_consumption
  include_duration_tracking: !input include_duration_tracking
  end_message_duration_tracking: !input end_message_duration_tracking
  start_time: "{{ now().timestamp() }}"
  include_watchdog: !input include_watchdog
  watchdog_timeframe: !input watchdog_timeframe
  watchdog_title: !input watchdog_title
  watchdog_message: !input watchdog_message
  watchdog_notify_interruption_level: !input watchdog_notify_interruption_level
  watchdog_notify_sound: !input watchdog_notify_sound
  watchdog_notify_data: !input watchdog_notify_data
  watchdog_notify_channel: !input watchdog_notify_channel
  include_custom_actions: !input include_custom_actions
  start_custom_actions: !input start_custom_actions
  watchdog_custom_actions: !input watchdog_custom_actions
  end_custom_actions: !input end_custom_actions
  include_time: !input include_time
  after_time: !input after_time
  before_time: !input before_time
  weekday_options: !input weekday_options
  global_conditions: !input global_conditions

# Start notify data

  start_message_data: >-
    {% set message = namespace(data={}) %}
    {% set push = namespace(data={}) %}
    {% if start_notify_interruption_level in ['active', 'critical', 'time-sensitive', 'passive'] %}
      {% set push.data = dict(push.data, **{ 'interruption-level': start_notify_interruption_level }) %}
    {% endif %}
    {% if start_notify_sound != [] %}
      {% set push.data = dict(push.data, **{ 'sound': start_notify_sound }) %}
    {% endif %}
    {% if push.data %}
      {% set message.data = dict(message.data, **{ 'push': push.data }) %}
    {% endif %}
    {% if 'high_priority' in start_notify_data %}
      {% set message.data = dict(message.data, **{ 'ttl': 0, 'priority': 'high' }) %}
    {% endif %}
    {% if 'channel' in start_notify_data %}
      {% set message.data = dict(message.data, **{ 'channel': start_notify_channel }) %}
    {% endif %}
    {% if 'sticky' in start_notify_data %}
      {% set message.data = dict(message.data, **{ 'sticky': "true" }) %}
    {% endif %}
    {{ message.data }}

# End notify data

  end_message_data: >-
    {% set message = namespace(data={}) %}
    {% set push = namespace(data={}) %}
    {% if end_notify_interruption_level in ['active', 'critical', 'time-sensitive', 'passive'] %}
      {% set push.data = dict(push.data, **{ 'interruption-level': end_notify_interruption_level }) %}
    {% endif %}
    {% if end_notify_sound != [] %}
      {% set push.data = dict(push.data, **{ 'sound': end_notify_sound }) %}
    {% endif %}
    {% if push.data %}
      {% set message.data = dict(message.data, **{ 'push': push.data }) %}
    {% endif %}
    {% if 'high_priority' in end_notify_data %}
      {% set message.data = dict(message.data, **{ 'ttl': 0, 'priority': 'high' }) %}
    {% endif %}
    {% if 'channel' in end_notify_data %}
      {% set message.data = dict(message.data, **{ 'channel': end_notify_channel }) %}
    {% endif %}
    {% if 'sticky' in end_notify_data %}
      {% set message.data = dict(message.data, **{ 'sticky': "true" }) %}
    {% endif %}
    {{ message.data }}

# Watchdog notify data

  watchdog_message_data: >-
    {% set message = namespace(data={}) %}
    {% set push = namespace(data={}) %}
    {% if watchdog_notify_interruption_level in ['active', 'critical', 'time-sensitive', 'passive'] %}
      {% set push.data = dict(push.data, **{ 'interruption-level': watchdog_notify_interruption_level }) %}
    {% endif %}
    {% if watchdog_notify_sound != [] %}
      {% set push.data = dict(push.data, **{ 'sound': watchdog_notify_sound }) %}
    {% endif %}
    {% if push.data %}
      {% set message.data = dict(message.data, **{ 'push': push.data }) %}
    {% endif %}
    {% if 'high_priority' in watchdog_notify_data %}
      {% set message.data = dict(message.data, **{ 'ttl': 0, 'priority': 'high' }) %}
    {% endif %}
    {% if 'channel' in watchdog_notify_data %}
      {% set message.data = dict(message.data, **{ 'channel': watchdog_notify_channel }) %}
    {% endif %}
    {% if 'sticky' in watchdog_notify_data %}
      {% set message.data = dict(message.data, **{ 'sticky': "true" }) %}
    {% endif %}
    {{ message.data }}

# Work out the actual watchdog duration taking into account the running dead zone time

  watchdog_duration: >-
    {% set dead_zone_seconds = running_dead_zone * 60 %}
    {% set hours = watchdog_timeframe.hours | default(0) %}
    {% set minutes = watchdog_timeframe.minutes | default(0) %}
    {% set seconds = watchdog_timeframe.seconds | default(0) %}
    {% set watchdog_seconds = (hours * 3600) + (minutes * 60) + seconds %}
    {% set duration_total_in_seconds = watchdog_seconds - dead_zone_seconds %}
    {% set duration_hours = duration_total_in_seconds // 3600 %}
    {% set duration_minutes = (duration_total_in_seconds % 3600) // 60 %}
    {% set duration_seconds = duration_total_in_seconds % 60 %}
    {{ '%02d:%02d:%02d' | format(duration_hours, duration_minutes, duration_seconds) }}

triggers:
  - trigger: numeric_state
    id: "t0"
    entity_id: !input power_sensor
    above: !input start_appliance_power
    below: "24000"
    for:
      minutes: !input start_time_delay

# All Conditions
condition:
# Check The Time Options
  - condition: or
    conditions:
      - "{{ include_time == 'time_disabled' }}"
      - condition: and
        conditions:
        - condition: time
          after: !input after_time
          before: !input before_time
          weekday: !input weekday_options
        -  "{{ include_time == 'time_enabled' }}"

# Global Conditions
  - condition: and
    conditions: !input global_conditions

action:
  - choose:
    - alias: "Check if power tracking is enabled"
      conditions:
        - "{{ (include_power_tracking == 'enable_power_tracking') or (include_power_tracking == 'enable_power_tracking_and_cost') or (include_power_tracking == 'enable_start_end_helpers') }}"
      sequence:
        - action: input_number.set_value
          target:
            entity_id: !input start_power_consumption
          data_template:
            value: "{{ states(power_consumption_sensor) | float }}"
  - choose:
    - alias: "Check if start of notification is enabled"
      conditions:
        - "{{ include_start_notify == 'enable_start_notify_options' }}"
      sequence:
        - alias: Send a notification to each device
          repeat:
            for_each: !input start_notify_device
            sequence:
              - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                data:
                  title: !input start_title
                  message: !input start_message
                  data: "{{ start_message_data }}"
  - choose:
    - alias: "Perform the custom start action"
      conditions:
        - condition: template
          value_template: "{{ 'enable_start_custom_actions' in include_custom_actions }}"
      sequence: !input start_custom_actions
  - alias: "Wait the number of minutes set in running dead zone"
    delay:
      minutes: !input running_dead_zone
  - choose:
      - conditions: "{{ include_watchdog == 'enable_watchdog' }}"
        sequence:
          - alias: "Wait until appliance has finished"
            repeat:
              count: !input end_repeat_count
              sequence:
                - wait_for_trigger:
                    - trigger: numeric_state
                      entity_id: !input power_sensor
                      below: !input end_appliance_power
                      for:
                        minutes: !input end_time_delay
                  timeout: "{{ watchdog_duration }}"
          - choose:
              - conditions: "{{ wait.trigger is none }}"
                sequence:
                  - choose:
                    - alias: "Check time condition"
                      conditions:
                        -  "{{ include_time == 'time_enabled' }}"
                        - condition: time
                          after: !input before_time
                          before: !input after_time
                          weekday: !input weekday_options
                      sequence:
                        - stop: "Stop the automation"
                  - alias: Send a notification to each device
                    repeat:
                      for_each: !input end_notify_device
                      sequence:
                        - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                          data:
                            title: !input watchdog_title
                            message: "{{watchdog_message}}"
                            data: "{{ watchdog_message_data }}"
                  - choose:
                    - alias: "Perform the custom watchdog action"
                      conditions:
                        - condition: template
                          value_template: "{{ 'enable_watchdog_custom_actions' in include_custom_actions }}"
                      sequence: !input watchdog_custom_actions
                  - stop: "Stop the automation"
      - conditions: "{{ include_watchdog == 'disable_watchdog' }}"
        sequence:
          - alias: "Wait until appliance has finished"
            repeat:
              count: !input end_repeat_count
              sequence:
                - wait_for_trigger:
                    - trigger: numeric_state
                      entity_id: !input power_sensor
                      below: !input end_appliance_power
                      for:
                        minutes: !input end_time_delay
  - choose:
    - alias: "Check time condition"
      conditions:
        -  "{{ include_time == 'time_enabled' }}"
        - condition: time
          after: !input before_time
          before: !input after_time
          weekday: !input weekday_options
      sequence:
        - stop: "Stop the automation"
  - choose:
    - alias: "Check if power tracking is enabled"
      conditions:
        - "{{ (include_power_tracking == 'enable_power_tracking') or (include_power_tracking == 'enable_power_tracking_and_cost') or (include_power_tracking == 'enable_start_end_helpers') }}"
      sequence:
        - action: input_number.set_value
          target:
            entity_id: !input end_power_consumption
          data_template:
            value: "{{ states(power_consumption_sensor) | float }}"
  - choose:
    - alias: "Perform the custom end action"
      conditions:
        - condition: template
          value_template: "{{ 'enable_end_custom_actions' in include_custom_actions }}"
      sequence: !input end_custom_actions
  - choose:
    - alias: "Check if end of notification is enabled"
      conditions:
        - "{{ include_end_notify == 'enable_end_notify_options' }}"
      sequence:
        - alias: Send a notification to each device
          repeat:
            for_each: !input end_notify_device
            sequence:
              - choose:
                - alias: "Check if end of notification is enabled and no power tracking"
                  conditions:
                    - "{{ (include_power_tracking == 'disable_power_tracking') or (include_power_tracking == 'enable_start_end_helpers') }}"
                  sequence:
                    - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                      data:
                        title: !input end_message_title
                        message: >
                          {{end_message}}
                          {% if include_duration_tracking == "enable_duration_tracking" %}
                          {% set end_time = now().timestamp() %}
                          {% set duration = (end_time - start_time) | int %}
                          {% set hours = (duration // 3600) | int %}
                          {% set minutes = ((duration % 3600) // 60) | int %}
                          {% set seconds = (duration % 60) | int %}
                          {{'\n'}}{{ end_message_duration_tracking }} {{ '%02d' | format(hours) }}:{{ '%02d' | format(minutes) }}:{{ '%02d' | format(seconds) }}
                          {% endif %}
                        data: "{{ end_message_data }}"
                - alias: "Check if end of notification is enabled and no power tracking is total power"
                  conditions:
                    - "{{ include_power_tracking == 'enable_power_tracking' }}"
                  sequence:
                    - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                      data:
                        title: !input end_message_title
                        message: >
                          {{end_message}}
                          {% set kwh = states(end_power_consumption) | float - states(start_power_consumption) | float %}
                          {{'\n'}}{{end_message_kwh}} {{kwh | round(2) }} kWh
                          {% if include_duration_tracking == "enable_duration_tracking" %}
                          {% set end_time = now().timestamp() %}
                          {% set duration = (end_time - start_time) | int %}
                          {% set hours = (duration // 3600) | int %}
                          {% set minutes = ((duration % 3600) // 60) | int %}
                          {% set seconds = (duration % 60) | int %}
                          {{'\n'}}{{ end_message_duration_tracking }} {{ '%02d' | format(hours) }}:{{ '%02d' | format(minutes) }}:{{ '%02d' | format(seconds) }}
                          {% endif %}
                        data: "{{ end_message_data }}"
                - alias: "Check if end of notification is enabled and no power tracking is total power and cost"
                  conditions:
                    - "{{ include_power_tracking == 'enable_power_tracking_and_cost' }}"
                  sequence:
                    - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                      data:
                        title: !input end_message_title
                        message: >
                          {{end_message}}
                          {% set kwh = states(end_power_consumption) | float - states(start_power_consumption) | float %}
                          {{'\n'}}{{end_message_kwh}} {{kwh | round(2) }} kWh
                          {% set cost = (states(end_power_consumption) | float - states(start_power_consumption) | float) * (states(cost_per_kwh) | float) %}
                          {{'\n'}}{{end_message_cost}}{{cost | round(2) }}
                          {% if include_duration_tracking == "enable_duration_tracking" %}
                          {% set end_time = now().timestamp() %}
                          {% set duration = (end_time - start_time) | int %}
                          {% set hours = (duration // 3600) | int %}
                          {% set minutes = ((duration % 3600) // 60) | int %}
                          {% set seconds = (duration % 60) | int %}
                          {{'\n'}}{{ end_message_duration_tracking }} {{ '%02d' | format(hours) }}:{{ '%02d' | format(minutes) }}:{{ '%02d' | format(seconds) }}
                          {% endif %}
                        data: "{{ end_message_data }}"
        - choose:
            - alias: "Check if end reminder notification is enabled"
              conditions:
                - condition: template
                  value_template: "{{ end_reminder_notification == 'enable_reminder_notification' }}"
              sequence:
                - wait_for_trigger:
                    - trigger: state
                      entity_id: !input end_reminder_notification_entity
                      to: 'on'
                  timeout:
                    minutes: !input end_reminder_notification_time_delay
                - repeat:
                    while:
                      - condition: template
                        value_template: "{{ (is_state(end_reminder_notification_entity, 'off')) and (repeat.index <= end_reminder_notification_max_count) }}"
                    sequence:
                      - repeat:
                          for_each: !input end_notify_device
                          sequence:
                            - action: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | slugify }}"
                              data:
                                title: !input end_message_title
                                message: !input end_reminder_notification_message
                                data: "{{ end_message_data }}"
                      - wait_for_trigger:
                          - trigger: state
                            entity_id: !input end_reminder_notification_entity
                            to: 'on'
                        timeout:
                          minutes: !input end_reminder_notification_time_delay
